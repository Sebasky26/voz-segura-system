@startuml arquitectura-voz-segura

title Arquitectura del Sistema Voz Segura\nPlataforma de Denuncias Anónimas (Next.js 16 - Monolítico)

skinparam componentStyle rectangle

' === CAPA FRONTEND ===
package "Frontend - React 19" #E3F2FD {
  component [Landing Page] as Landing
  component [Login/Registro] as Auth
  component [Dashboard] as Dashboard
  component [CRUD Denuncias] as Denuncias
  component [Chat WebSocket] as Chat
}

' === CAPA BACKEND ===
package "Backend - Next.js API Routes" #FFF3E0 {
  component [/api/auth/login\n/api/auth/register] as APIAuth
  component [/api/denuncias\n/api/denuncias/[id]] as APIDenuncias
  component [/api/chat] as APIChat
  component [Socket.IO Server] as SocketIO
}

' === CAPA LÓGICA ===
package "Lógica de Negocio" #FFF9C4 {
  component [auth.ts\n- hashPassword\n- generateToken\n- verifyToken] as AuthLib
  component [auditoria.ts\n- registrarLog\n- registrarCambio] as AuditoriaLib
  component [prisma.ts\n- ORM Client] as PrismaLib
}

' === BASE DE DATOS ===
database "PostgreSQL" #F3E5F5 {
  frame "Tablas" {
    storage usuarios
    storage denuncias
    storage evidencias
    storage mensajes_chat
    storage historial_denuncias
    storage auditoria_logs
  }
}

' === SERVICIOS EXTERNOS ===
cloud "Servicios" #E8F5E9 {
  component [JWT] as JWT
  component [bcrypt] as Bcrypt
  component [Socket.IO] as SocketIOLib
}

' === RELACIONES FRONTEND -> BACKEND ===
Landing --> Auth : navegar
Auth --> APIAuth : POST login/register
Dashboard --> APIDenuncias : GET denuncias
Denuncias --> APIDenuncias : CRUD operations
Chat --> SocketIO : WebSocket
Chat --> APIChat : GET mensajes

' === RELACIONES BACKEND -> LÓGICA ===
APIAuth --> AuthLib : usar
APIDenuncias --> AuthLib : verificar token
APIDenuncias --> AuditoriaLib : registrar
APIAuth --> AuditoriaLib : registrar
APIChat --> PrismaLib : guardar
SocketIO --> PrismaLib : mensajes

' === RELACIONES LÓGICA -> BASE DE DATOS ===
PrismaLib --> usuarios
PrismaLib --> denuncias
PrismaLib --> evidencias
PrismaLib --> mensajes_chat
PrismaLib --> historial_denuncias
PrismaLib --> auditoria_logs

' === RELACIONES CON SERVICIOS EXTERNOS ===
AuthLib --> JWT : sign/verify
AuthLib --> Bcrypt : hash/compare
SocketIO --> SocketIOLib : protocolo

' === RELACIONES ENTRE TABLAS ===
denuncias "1" --> "0..*" evidencias
denuncias "1" --> "0..*" historial_denuncias
usuarios "1" --> "0..*" denuncias : crea
usuarios "1" --> "0..*" mensajes_chat : envía
usuarios "1" --> "0..*" auditoria_logs : genera

note right of denuncias
  **Campos Principales:**
  - id (UUID)
  - codigoAnonimo (único)
  - titulo, descripcion
  - categoria, estado
  - prioridad
  - denuncianteId (opcional)
  - supervisorId
  
  **Estados:**
  PENDIENTE, EN_REVISION
  APROBADA, DERIVADA
  CERRADA, RECHAZADA
end note

note right of usuarios
  **Roles:**
  - DENUNCIANTE
  - SUPERVISOR
  - ADMIN
  
  **Seguridad:**
  - passwordHash (bcrypt)
  - intentosFallidos
  - bloqueadoHasta
end note

note bottom of AuthLib
  **Seguridad:**
  - bcrypt 12 rounds
  - JWT 7 días expiración
  - Código anónimo único
end note

note bottom of SocketIO
  **Eventos WebSocket:**
  - send-message
  - new-message
  - user-typing
  - users-online
end note

legend right
  **Stack Tecnológico**
  - Next.js 16.0.3 (App Router)
  - React 19.2.0
  - TypeScript 5
  - Prisma 6.19.0
  - PostgreSQL
  - Socket.IO 4.8.1
  - JWT + bcrypt
  - Tailwind CSS 4
  
  **Arquitectura:** Monolítica
  Todo en un proyecto unificado
endlegend

@enduml
